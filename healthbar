--health esp, by @sn0w.devzz


local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer


if not game:IsLoaded() then
    game.Loaded:Wait()
end



local HealthbarESP = {}
HealthbarESP.Enabled = true
HealthbarESP.Objects = {}

function HealthbarESP:Create(player)
    if player == LocalPlayer then return end
    if self.Objects[player] then return end
    
    local healthbar = {
        Background = Drawing.new("Square"),
        Fill = Drawing.new("Square"),
        Outline = Drawing.new("Square")
    }
    
    healthbar.Background.Visible = false
    healthbar.Background.Color = Color3.fromRGB(0, 0, 0)
    healthbar.Background.Filled = true
    healthbar.Background.Transparency = 0.5
    
    healthbar.Fill.Visible = false
    healthbar.Fill.Color = Color3.fromRGB(0, 255, 0)
    healthbar.Fill.Filled = true
    healthbar.Fill.Transparency = 1
    
    healthbar.Outline.Visible = false
    healthbar.Outline.Color = Color3.fromRGB(0, 0, 0)
    healthbar.Outline.Filled = false
    healthbar.Outline.Thickness = 1
    healthbar.Outline.Transparency = 1
    
    self.Objects[player] = healthbar
end

function HealthbarESP:Remove(player)
    if self.Objects[player] then
        local healthbar = self.Objects[player]
        healthbar.Background:Remove()
        healthbar.Fill:Remove()
        healthbar.Outline:Remove()
        self.Objects[player] = nil
    end
end

function HealthbarESP:Update()
    for player, healthbar in pairs(self.Objects) do
        if not player or not player.Parent or not player.Character then
            continue
        end
        
        local character = player.Character
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        local head = character:FindFirstChild("Head")
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        
        if not rootPart or not head or not humanoid then
            healthbar.Background.Visible = false
            healthbar.Fill.Visible = false
            healthbar.Outline.Visible = false
            continue
        end
        
        local camera = workspace.CurrentCamera
        local rootPos, onScreen = camera:WorldToViewportPoint(rootPart.Position)
        
        if not onScreen or not self.Enabled then
            healthbar.Background.Visible = false
            healthbar.Fill.Visible = false
            healthbar.Outline.Visible = false
            continue
        end
        
        local headPos = camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
        local legPos = camera:WorldToViewportPoint(rootPart.Position - Vector3.new(0, 3, 0))
        
        local height = math.abs(headPos.Y - legPos.Y)
        local width = height / 2
        
        local healthPercent = humanoid.Health / humanoid.MaxHealth
        
        local barWidth = 4
        local barHeight = height
        local barX = rootPos.X - width / 2 - barWidth - 2
        local barY = rootPos.Y - height / 2
        
        -- Background
        healthbar.Background.Size = Vector2.new(barWidth, barHeight)
        healthbar.Background.Position = Vector2.new(barX, barY)
        healthbar.Background.Visible = true
        
        -- Fill
        healthbar.Fill.Size = Vector2.new(barWidth, barHeight * healthPercent)
        healthbar.Fill.Position = Vector2.new(barX, barY + barHeight * (1 - healthPercent))
        
        -- Gradient color
        local r = math.floor(255 * (1 - healthPercent))
        local g = math.floor(255 * healthPercent)
        healthbar.Fill.Color = Color3.fromRGB(r, g, 0)
        
        healthbar.Fill.Visible = true
        
        -- Outline
        healthbar.Outline.Size = Vector2.new(barWidth, barHeight)
        healthbar.Outline.Position = Vector2.new(barX, barY)
        healthbar.Outline.Visible = true
    end
end

-- Initialize Healthbar ESP
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        HealthbarESP:Create(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    HealthbarESP:Create(player)
end)

Players.PlayerRemoving:Connect(function(player)
    HealthbarESP:Remove(player)
end)

RunService.RenderStepped:Connect(function()
    HealthbarESP:Update()
end)
