--highlight esp, by @sn0w.devzz


local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer


if not game:IsLoaded() then
    game.Loaded:Wait()
end


local HighlightESP = {}
HighlightESP.Enabled = true
HighlightESP.Objects = {}

function HighlightESP:Create(player)
    if player == LocalPlayer then return end
    if self.Objects[player] then return end
    
    if not player.Character then return end
    
    local highlight = Instance.new("Highlight")
    highlight.Parent = player.Character
    highlight.FillColor = Color3.fromRGB(255, 0, 0)
    highlight.OutlineColor = Color3.fromRGB(0, 0, 255)
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Enabled = self.Enabled
    
    self.Objects[player] = highlight
    
    player.CharacterAdded:Connect(function(character)
        task.wait(0.1)
        if self.Objects[player] then
            self.Objects[player]:Destroy()
        end
        
        local newHighlight = Instance.new("Highlight")
        newHighlight.Parent = character
        newHighlight.FillColor = Color3.fromRGB(255, 0, 0)
        newHighlight.OutlineColor = Color3.fromRGB(0, 0, 255)
        newHighlight.FillTransparency = 0.5
        newHighlight.OutlineTransparency = 0
        newHighlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        newHighlight.Enabled = self.Enabled
        
        self.Objects[player] = newHighlight
    end)
end

function HighlightESP:Remove(player)
    if self.Objects[player] then
        self.Objects[player]:Destroy()
        self.Objects[player] = nil
    end
end

function HighlightESP:Update()
    for player, highlight in pairs(self.Objects) do
        if not player or not player.Parent then
            continue
        end
        
        if highlight then
            highlight.Enabled = self.Enabled
        end
    end
end


for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        HighlightESP:Create(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Wait()
    task.wait(0.1)
    HighlightESP:Create(player)
end)

Players.PlayerRemoving:Connect(function(player)
    HighlightESP:Remove(player)
end)

RunService.RenderStepped:Connect(function()
    HighlightESP:Update()
end)
